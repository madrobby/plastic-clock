<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Perpetual Day Calendar brought to you by Noko Time Tracking</title>
  <link rel="stylesheet" href="perpetual-day.css">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="apple-mobile-web-app-title" content="Perpetual Day">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="twitter:widgets:csp" content="on">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@nokotime">
  <meta name="twitter:title" content="Perpetual Day Calendar by Noko">
  <meta name="twitter:description" content="Retro perpetual calendar right in your browser.">
  <meta name="twitter:image" content="https://perpetual.day/perpetual-day-calendar.jpg">
  <meta property="og:image" content="https://perpetual.day/perpetual-day-calendar.jpg">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Perpetual Day Calendar by Noko">
  <meta property="og:description" content="Retro perpetual calendar right in your browser.">
  <meta property="og:url" content="https://perpetual.day/">
  <script src="https://cdn.usefathom.com/script.js" data-site="FKOWVRGD" defer></script>
</head>
<body class="memphis">
<div id="c">
<ul id="w">
<li>Sun</li><li>Mon</li><li>Tue</li><li>Wed</li><li>Thu</li><li>Fri</li><li>Sat</li>
</ul>
<ul id="d">
</ul>
<ul id="m">
<li>Jan</li><li>Feb</li><li>Mar</li><li>Apr</li><li>May</li><li>Jun</li><li>Jul</li><li>Aug</li><li>Sep</li><li>Oct</li><li>Nov</li><li>Dec</li>
</ul>

<div id="t">
  <div id="th">
    <div class="n"></div>
    <div class="p"></div>
    <div class="c2"></div>
    <div class="c"></div>
  </div>
  <div id="tm">
    <div class="n"></div>
    <div class="p"></div>
    <div class="c2"></div>
    <div class="c"></div>
  </div>
  <div id="ts">
    <div class="n"></div>
    <div class="p"></div>
    <div class="c2"></div>
    <div class="c"></div>
  </div>
</div>

</div>
<div id="sel">
  <select id="style" onchange="__style(this)">
    <option value="plastic">Plastic</option>
    <option value="memphis" selected>Memphis</option>
    <option value="keeping-up">Keeping Up</option>
    <option value="golf-ball">Golf Ball</option>
  </select>
</div>
<div id="noko">
  Perpetual Calendar :: <a href="https://nokotime.com/">Noko Time Tracking</a>
</div>
<script>
  ((t) => {
    var p, n, f = false, q = t.querySelectorAll.bind(t), lstor = 'localStorage' in window,
      old, cur, last = [-1,-1,-1], r, h = (id,x) => q(id)[0].innerHTML = x,
      sfs = (fs) => document.querySelector(":root").style.setProperty('font-size', fs+'rem');

    window.__style = x => {
      q('body')[0].className = x.value;
      if (lstor) localStorage['__style'] = x.value;
      fit();
    }

    if (lstor && '__style' in localStorage) {
      q('body')[0].className = localStorage['__style'];
      q('#style')[0].value = localStorage['__style'];
    }

    q("#d")[0].innerHTML =
      [...Array(31).keys()].map(j => `<li>${j+1}</li>`).join('');

    function debounce(func, timeout = 300){
      let timer;
      return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => { func.apply(this, args); }, timeout);
      };
    }

    // why, oh, why doesn't CSS have anything proper to fit things into other things
    function fit(){
      const h = innerHeight * 0.9, m = 1.05;
      var b, sz = 0.9, c = 50;
      sfs(sz);

      while(true) {
        b = q('#t')[0].getBoundingClientRect().bottom;
        if (b > h) break;
        sz = sz * m;
        c = c - 1;
        if (c == 0) break;
        sfs(sz);
      }
      sfs(sz/m);
    }
    fit();
    addEventListener("resize", debounce(fit));

    r = (x) =>
      Array.from(q(x)).forEach(e => {
        e.classList.remove('anim');
        e.offsetHeight;
        e.classList.add('anim');
      });

    (function u(){
      n = ((x) => [x.getDay()+1,x.getDate(),x.getMonth()+1,x.getHours(),x.getMinutes(),x.getSeconds()])(new Date());

      if (!(n.join('/') == p)) {
        p = n.join('/');

        Array.from(q('li')).forEach(l => l.className = '');

        ['w','d','m'].forEach((y,i) =>
          q(`#${y} li:nth-child(${n[i]})`)[0].className = 'a');

        ['#th','#tm','#ts'].forEach((y,i) => {
          if (last[i] == n[i+3]) return;
          cur = n[i+3] < 10 ? '0' + n[i+3] : n[i+3];
          old = n[i+3] == 0 ? 59 : n[i+3]-1;
          if (old<10) old = '0' + old;
          h(y+' .n', cur);
          h(y+' .p', old);
          h(y+' .c', cur);
          h(y+' .c2', old);
          r(y+' > div');
        });
        last = [n[3],n[4],n[5]];
      }

      setTimeout(() => {
        if(f) cancelAnimationFrame(f);
        f = requestAnimationFrame(u);
      }, 1000);
    })();
  })(document);
</script>
</body>
</html>